#include <stdio.h>
#include <math.h>
#include <complex.h>

typedef float complex cplx;

float s2[512] = {4.3917535,-0.4349594,-0.1374959,2.3005731,5.2494492,
                3.4014380,-0.4842622,6.1108828,7.0043131,2.6272175,
                3.7479276,5.8281444,8.6448244,4.2096884,2.8472752,
                9.6923200,7.4571980,4.5382063,5.5634940,8.1405187,
                9.7145387,3.6088502,5.5786915,10.6506537,6.6030371,
                4.9749153,5.4877457,8.8180753,7.6897855,1.5253946,
                6.1029421,8.0262842,3.6223400,2.4251694,2.9509539,
                6.6053097,2.3148477,-1.7862577,3.9714141,3.0266440,
                -0.4660132,-1.7106833,0.0432113,2.9799862,-3.5697308,
                -4.1924618,0.9525846,-1.6911698,-4.1745579,-5.5555767,
                -2.0404552,-1.4014532,-8.5078719,-5.7886845,-2.6424269,
                -5.6110792,-7.6957644,-8.4027359,-3.4055772,-5.8041317,
                -11.1435657,-6.1384066,-4.9845721,-7.1414214,-9.2491451,
                -7.9490253,-2.7036236,-7.7139638,-9.7012539,-4.2184912,
                -4.3740157,-5.8500618,-8.1611941,-4.3160641,-0.8630447,
                -7.2056865,-5.7764910,-1.4468302,-1.9897407,-3.6112184,
                -5.3683961,0.6889456,1.0049999,-4.5794075,-0.6519080,
                2.1155544,1.9030527,-0.5448245,-0.4398747,6.3633030,
                3.2931776,0.0081231,4.6310245,6.0774840,5.7429056,
                2.1345234,4.7791011,9.9981894,4.3923479,3.7383950,
                7.4595673,8.2821393,6.8863569,2.9982353,8.1617808,
                10.1601152,4.0240933,5.5122861,7.9501234,8.7836537,
                5.6197745,3.0848544,9.5724448,7.7915708,2.8734499,
                5.1394121,6.5987575,7.0272498,1.8869934,1.9485812,
                7.6474581,2.8073113,-0.0452301,1.8586992,3.2222574,
                2.4272149,-3.4982318,-0.2000000,3.1140596,-2.7651563,
                -3.4872237,-2.0297213,-0.0183132,-2.7583471,-7.4898613,
                -1.6948239,-1.5571577,-6.6474386,-6.1990285,-4.7513996,
                -2.5278608,-7.5157546,-9.3882293,-3.0068183,-5.6540935,
                -8.9276117,-8.1923279,-5.8335691,-4.3990289,-10.5590314,
                -8.5531078,-3.3510038,-7.1726492,-8.4792986,-7.5519905,
                -3.7187679,-4.2622238,-9.7678661,-4.4668062,-1.7649716,
                -5.3453428,-5.6833729,-4.2715547,0.2882574,-3.0833417,
                -6.2566179,0.4349661,0.4287106,-2.1211827,-2.4184380,
                0.2882408,4.1837369,-1.4013610,-1.0546295,5.0623292,
                3.3889903,1.8689383,1.4370137,5.8784373,7.4113276,
                1.1561064,4.6733538,8.5544363,6.2481357,4.7454181,
                4.5338298,9.9355730,7.8487197,2.7281519,7.8613848,
                9.0562715,6.8585786,4.6341441,5.7481257,10.7443185,
                5.4275141,3.0813943,8.1566433,7.5472375,5.5718724,
                2.7156428,5.9685291,8.7801123,1.7445446,2.4272458,
                5.9554562,4.5558803,2.0237576,-0.6950520,4.3545583,
                3.6235630,-3.0386783,-0.2097831,1.4494142,0.1307233,
                -3.4094201,-4.3713839,1.4007473,-2.6553898,-6.8739333,
                -3.1264004,-2.4935542,-3.5782512,-7.8732108,-5.8529983,
                -1.1983607,-7.3115426,-8.4185571,-5.0985697,-4.6268805,
                -6.3236866,-10.4620950,-5.4958469,-3.6382760,-9.8539061,
                -8.3787984,-5.8818287,-4.9114034,-7.8557231,-10.0846341,
                -3.2023311,-4.4993873,-8.8462397,-5.9253365,-3.7332047,
                -2.5017448,-6.7780204,-5.8016787,0.8519078,-3.0044462,
                -4.8545287,-1.9389774,0.4371505,0.6489585,-4.2803456,
                -0.0000000,4.2803456,-0.6489585,-0.4371505,1.9389774,
                4.8545287,3.0044462,-0.8519078,5.8016787,6.7780204,
                2.5017448,3.7332047,5.9253365,8.8462397,4.4993873,
                3.2023311,10.0846341,7.8557231,4.9114034,5.8818287,
                8.3787984,9.8539061,3.6382760,5.4958469,10.4620950,
                6.3236866,4.6268805,5.0985697,8.4185571,7.3115426,
                1.1983607,5.8529983,7.8732108,3.5782512,2.4935542,
                3.1264004,6.8739333,2.6553898,-1.4007473,4.3713839,
                3.4094201,-0.1307233,-1.4494142,0.2097831,3.0386783,
                -3.6235630,-4.3545583,0.6950520,-2.0237576,-4.5558803,
                -5.9554562,-2.4272458,-1.7445446,-8.7801123,-5.9685291,
                -2.7156428,-5.5718724,-7.5472375,-8.1566433,-3.0813943,
                -5.4275141,-10.7443185,-5.7481257,-4.6341441,-6.8585786,
                -9.0562715,-7.8613848,-2.7281519,-7.8487197,-9.9355730,
                -4.5338298,-4.7454181,-6.2481357,-8.5544363,-4.6733538,
                -1.1561064,-7.4113276,-5.8784373,-1.4370137,-1.8689383,
                -3.3889903,-5.0623292,1.0546295,1.4013610,-4.1837369,
                -0.2882408,2.4184380,2.1211827,-0.4287106,-0.4349661,
                6.2566179,3.0833417,-0.2882574,4.2715547,5.6833729,
                5.3453428,1.7649716,4.4668062,9.7678661,4.2622238,
                3.7187679,7.5519905,8.4792986,7.1726492,3.3510038,
                8.5531078,10.5590314,4.3990289,5.8335691,8.1923279,
                8.9276117,5.6540935,3.0068183,9.3882293,7.5157546,
                2.5278608,4.7513996,6.1990285,6.6474386,1.5571577,
                1.6948239,7.4898613,2.7583471,0.0183132,2.0297213,
                3.4872237,2.7651563,-3.1140596,0.2000000,3.4982318,
                -2.4272149,-3.2222574,-1.8586992,0.0452301,-2.8073113,
                -7.6474581,-1.9485812,-1.8869934,-7.0272498,-6.5987575,
                -5.1394121,-2.8734499,-7.7915708,-9.5724448,-3.0848544,
                -5.6197745,-8.7836537,-7.9501234,-5.5122861,-4.0240933,
                -10.1601152,-8.1617808,-2.9982353,-6.8863569,-8.2821393,
                -7.4595673,-3.7383950,-4.3923479,-9.9981894,-4.7791011,
                -2.1345234,-5.7429056,-6.0774840,-4.6310245,-0.0081231,
                -3.2931776,-6.3633030,0.4398747,0.5448245,-1.9030527,
                -2.1155544,0.6519080,4.5794075,-1.0049999,-0.6889456,
                5.3683961,3.6112184,1.9897407,1.4468302,5.7764910,
                7.2056865,0.8630447,4.3160641,8.1611941,5.8500618,
                4.3740157,4.2184912,9.7012539,7.7139638,2.7036236,
                7.9490253,9.2491451,7.1414214,4.9845721,6.1384066,
                11.1435657,5.8041317,3.4055772,8.4027359,7.6957644,
                5.6110792,2.6424269,5.7886845,8.5078719,1.4014532,
                2.0404552,5.5555767,4.1745579,1.6911698,-0.9525846,
                4.1924618,3.5697308,-2.9799862,-0.0432113,1.7106833,
                0.4660132,-3.0266440,-3.9714141,1.7862577,-2.3148477,
                -6.6053097,-2.9509539,-2.4251694,-3.6223400,-8.0262842,
                -6.1029421,-1.5253946,-7.6897855,-8.8180753,-5.4877457,
                -4.9749153,-6.6030371,-10.6506537,-5.5786915,-3.6088502,
                -9.7145387,-8.1405187,-5.5634940,-4.5382063,-7.4571980,
                -9.6923200,-2.8472752,-4.2096884,-8.6448244,-5.8281444,
                -3.7479276,-2.6272175,-7.0043131,-6.1108828,0.4842622,
                -3.4014380,-5.2494492,-2.3005731,0.1374959,0.4349594,
                -4.3917535,-0.0000000};

cplx xFFT[512];
int size = sizeof(s2)/sizeof(s2[0]);

int reverse_bit(int n, int length);
void fft();
void print_arr(cplx *arr);

int main(){

    fft(s2, xFFT);
    print_arr(xFFT);

    return 0;
}

int reverse_bit(int n, int length){
    int reverse = 0;
    for(int i = 0; i < length; i++){
        reverse = (reverse << 1) | (n & 1);
        n = n >> 1;
    }
    return reverse;
}

void fft(float *arr, cplx *fft_val){
    int num_bit = log2(size);
    for(int i = 0; i < size; i++){
        fft_val[reverse_bit(i, num_bit)] =  arr[i];
    }

    int q = round(log(size)/log(2));
    for(int s = 1; s < q+1; s++){
        int m = pow(2,s);
        int m2 = m/2;
        cplx w = 1;
        cplx wm = cexp(I*(M_PI/m2));
        for(int j = 1; j < m2+1; j++){
            for(int k = j; k < size+1; k+=m){
                cplx t = w * fft_val[k+m2-1];
                cplx u = fft_val[k-1];
                fft_val[k-1] = u + t;
                fft_val[k+m2-1] = u - t;
            }
            w = w * wm;
        }

    }
}

void print_arr(cplx *arr){
    for(int i = 0; i < size; i++){
        printf("%f + %fj, ", creal(arr[i]), cimag(arr[i]));
    }
}
