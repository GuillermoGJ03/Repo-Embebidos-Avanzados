#include <stdio.h>
#include <math.h>
#include <complex.h>

typedef float complex cplx;

static float s1[1024] = {1.4859103,-1.1279211,2.2003448,-0.6515370,3.0343337,
                -0.9082090,2.1959096,1.2907831,0.0331495,1.8350411,
                -0.6054200,2.3451285,-2.2223967,1.9001265,-1.0214101,
                -0.4848145,-0.2404893,-1.2016807,0.7684542,-2.9401210,
                1.8721027,-1.9409974,0.5773492,-0.4255162,0.5866786,
                1.1380348,-0.9341424,3.4300142,-0.7144104,2.7744448,
                0.3869338,2.7041912,1.1137586,0.6619752,3.2413335,
                -0.7402470,2.5859510,-0.7373893,2.3194805,-1.0869290,
                0.4083102,0.9957841,-1.6205331,1.2176136,-1.6984293,
                1.9033882,-2.1499244,1.4662294,0.3543004,-0.1277944,
                1.7437131,0.0273128,3.2345332,-0.8266296,3.8752531,
                0.9435476,2.1464065,2.1630361,1.6146532,3.1573586,
                -0.4684036,4.0136103,-0.3308689,2.0622639,0.2674273,
                1.1885261,0.8620275,-1.1945619,2.5761854,-1.7650108,
                1.7086723,-0.9094500,1.7870279,-0.0153606,0.3095991,
                2.8427346,-0.4683395,3.2408523,0.3495707,3.9755779,
                0.6604229,2.9150594,3.2362671,1.1140777,3.7024420,
                0.8268455,4.1467860,-0.3292435,3.2172672,1.2188640,
                0.7074528,1.7593905,-0.0858958,2.4985492,-1.7535502,
                2.8680232,-0.4730591,1.1407412,0.9100473,0.9765448,
                2.4628848,-0.4628516,4.3582470,0.3534458,3.4603780,
                1.7721921,3.4130915,2.9259352,1.4847507,5.0158142,
                0.7192270,4.1099174,1.0626425,3.6712453,1.0659983,
                1.4219587,3.0455806,-0.4376164,2.7400489,-0.4838373,
                2.9712217,-0.7591251,1.8738781,1.7762480,0.2327260,
                2.8151748,0.4901599,4.1213203,0.0383766,4.3241348,
                2.3434776,2.6613856,3.6680072,2.3861996,4.8180646,
                0.7406286,5.3378463,1.5188872,3.2015534,2.2222645,
                2.2389197,2.8589839,-0.1908579,4.0354349,-0.4320689,
                2.5803902,0.3858993,2.2567196,1.3326994,0.4602589,
                3.8630322,0.0155133,3.8198253,1.0787196,4.3713292,
                1.8560748,3.1183736,4.6511874,1.7762556,4.9886145,
                1.9098140,5.3840711,1.3004581,4.0903835,3.1810362,
                1.6542437,3.4798009,0.9170525,3.9379332,-0.5794160,
                3.5767273,0.9184668,1.4811009,2.0361072,1.1440842,
                3.4102545,-0.2105194,4.7447932,1.0995156,3.5685695,
                2.6912035,3.5375900,4.1450352,1.8120414,6.0903398,
                1.7526416,4.9861600,2.4666793,4.4805570,2.8489564,
                2.0861818,4.6858522,0.5640665,3.8846548,0.6081874,
                3.6851094,0.4989229,1.9884953,2.9079771,0.3541810,
                3.4531266,0.6694643,4.4346356,0.5494868,4.1324996,
                3.2098828,2.5711303,4.4977265,2.5809002,5.7162709,
                1.4534520,5.9047673,2.8770546,3.7365933,3.6849277,
                2.8403764,4.3667710,0.5512708,5.0047913,0.7086999,
                3.0514859,1.4547309,2.3791785,2.3541693,0.3326588,
                4.3808303,0.2007638,3.8048807,1.3912605,4.0988893,
                2.4932964,2.6720984,5.3142381,1.8370995,5.4521314,
                2.4046666,5.8019664,2.3740778,4.2687074,4.5447814,
                2.1031392,4.6165425,1.5601451,4.8241426,0.3450296,
                3.8042018,2.0137843,1.4607377,2.7722932,0.9877625,
                3.8387082,-0.2709247,4.4910390,1.4063477,3.0177097,
                3.0000000,2.9821774,4.5932006,1.5079445,6.2691176,
                2.1584683,5.0081718,3.2221731,4.5320350,3.9770692,
                2.1845069,5.6413088,1.1596001,4.4207767,1.3613332,
                3.8714653,1.4263270,1.6986800,3.5893641,0.1573053,
                3.5502106,0.4981271,4.1083164,0.6261111,3.2629606,
                3.4362490,1.8249193,4.5265881,2.1067852,5.7044968,
                1.5178026,5.5591245,3.5305424,3.4982401,4.4151734,
                2.8106830,5.1455129,0.8412450,5.2863689,1.4622523,
                2.9798112,2.1262048,2.0652655,2.9153120,-0.1221109,
                4.3192765,0.0463122,3.1713207,1.2439155,3.1597167,
                2.5099535,1.5761105,5.1476823,1.2508780,5.0041797,
                2.2084341,5.2950834,2.7287782,3.6355388,5.1121781,
                1.9128474,4.9764143,1.6863816,4.9931950,0.8574250,
                3.4429024,2.6657267,1.0195173,3.0185792,0.4840762,
                3.7023663,-0.6507656,3.6118944,1.2630579,1.8544568,
                2.6845940,1.7907763,4.2431767,0.5810445,5.5193020,
                1.8812731,4.1299891,3.2203134,3.7574690,4.3020551,
                1.6255501,5.7632532,1.2272685,4.2293192,1.6475470,
                3.4538875,1.9076859,0.9787379,3.7488718,-0.3547228,
                3.0993633,0.0002032,3.1920146,0.2963484,1.8082415,
                3.0494341,0.5128888,3.7840236,1.0212601,4.8037319,
                0.9341914,4.3147625,3.4199400,2.4733590,4.3214403,
                2.1040331,5.0933996,0.6026278,4.8054780,1.7320197,
                2.3282946,2.3209886,1.3175674,2.9759312,-0.8674996,
                3.7050781,-0.3971652,2.0097260,0.7027791,1.6840969,
                1.9765374,-0.0297498,4.2302166,0.1213203,3.7263685,
                1.3750827,3.9311027,2.3609953,2.2366239,4.8427311,
                1.0853345,4.5131910,1.2619507,4.4121110,0.9012596,
                2.4970784,2.8250881,0.1917439,2.7721042,-0.3035577,
                3.0586024,-1.2666573,2.2355926,0.7654544,0.2492053,
                1.8608741,0.1433209,3.2207500,-0.8136887,3.9776388,
                1.0219990,2.4783043,2.5146372,2.2536497,3.8370285,
                0.4653982,5.0562981,0.7734007,3.3269247,1.4505952,
                2.4713690,1.9286741,-0.1011313,3.4138600,-1.0938051,
                2.1943848,-0.7130760,1.8433114,-0.3109661,-0.0219567,
                2.2003725,-1.1471975,2.4462883,-0.4776201,3.1988410,
                -0.1450667,2.3551338,2.6470580,0.8115350,3.4747806,
                0.8233293,4.2635882,-0.1111264,3.6260098,1.5357177,
                1.1754261,2.0626430,0.2338367,2.5929134,-1.7857071,
                2.6620816,-0.9979884,0.5103279,-0.0725240,-0.0904422,
                1.0777915,-1.8886152,2.7784913,-1.3175210,1.8547776,
                0.1033847,1.9398301,1.4226049,0.2754786,3.8563696,
                -0.2322701,3.3341575,0.3826630,3.1852978,0.5334099,
                1.0852554,2.5448101,-0.8973389,2.1237380,-1.2354476,
                2.0548544,-1.9626716,0.5806930,0.0928692,-1.5336493,
                0.7474781,-1.6762055,1.7764357,-2.4042429,1.9236211,
                -0.1848859,0.3301045,1.3058990,0.2666003,2.7484816,
                -1.1011141,3.6745850,-0.0705424,1.8630139,0.8652191,
                1.0729173,1.5728638,-1.3853427,2.7004913,-1.9037411,
                1.0100836,-1.4671167,0.2980220,-0.9963770,-1.9382800,
                1.1290524,-2.8502849,0.7987844,-2.0899045,1.2015503,
                -1.4490949,-0.0000000,1.4490949,-1.2015503,2.0899045,
                -0.7987844,2.8502849,-1.1290524,1.9382800,0.9963770,
                -0.2980220,1.4671167,-1.0100836,1.9037411,-2.7004913,
                1.3853427,-1.5728638,-1.0729173,-0.8652191,-1.8630139,
                0.0705424,-3.6745850,1.1011141,-2.7484816,-0.2666003,
                -1.3058990,-0.3301045,0.1848859,-1.9236211,2.4042429,
                -1.7764357,1.6762055,-0.7474781,1.5336493,-0.0928692,
                -0.5806930,1.9626716,-2.0548544,1.2354476,-2.1237380,
                0.8973389,-2.5448101,-1.0852554,-0.5334099,-3.1852978,
                -0.3826630,-3.3341575,0.2322701,-3.8563696,-0.2754786,
                -1.4226049,-1.9398301,-0.1033847,-1.8547776,1.3175210,
                -2.7784913,1.8886152,-1.0777915,0.0904422,0.0725240,
                -0.5103279,0.9979884,-2.6620816,1.7857071,-2.5929134,
                -0.2338367,-2.0626430,-1.1754261,-1.5357177,-3.6260098,
                0.1111264,-4.2635882,-0.8233293,-3.4747806,-0.8115350,
                -2.6470580,-2.3551338,0.1450667,-3.1988410,0.4776201,
                -2.4462883,1.1471975,-2.2003725,0.0219567,0.3109661,
                -1.8433114,0.7130760,-2.1943848,1.0938051,-3.4138600,
                0.1011313,-1.9286741,-2.4713690,-1.4505952,-3.3269247,
                -0.7734007,-5.0562981,-0.4653982,-3.8370285,-2.2536497,
                -2.5146372,-2.4783043,-1.0219990,-3.9776388,0.8136887,
                -3.2207500,-0.1433209,-1.8608741,-0.2492053,-0.7654544,
                -2.2355926,1.2666573,-3.0586024,0.3035577,-2.7721042,
                -0.1917439,-2.8250881,-2.4970784,-0.9012596,-4.4121110,
                -1.2619507,-4.5131910,-1.0853345,-4.8427311,-2.2366239,
                -2.3609953,-3.9311027,-1.3750827,-3.7263685,-0.1213203,
                -4.2302166,0.0297498,-1.9765374,-1.6840969,-0.7027791,
                -2.0097260,0.3971652,-3.7050781,0.8674996,-2.9759312,
                -1.3175674,-2.3209886,-2.3282946,-1.7320197,-4.8054780,
                -0.6026278,-5.0933996,-2.1040331,-4.3214403,-2.4733590,
                -3.4199400,-4.3147625,-0.9341914,-4.8037319,-1.0212601,
                -3.7840236,-0.5128888,-3.0494341,-1.8082415,-0.2963484,
                -3.1920146,-0.0002032,-3.0993633,0.3547228,-3.7488718,
                -0.9787379,-1.9076859,-3.4538875,-1.6475470,-4.2293192,
                -1.2272685,-5.7632532,-1.6255501,-4.3020551,-3.7574690,
                -3.2203134,-4.1299891,-1.8812731,-5.5193020,-0.5810445,
                -4.2431767,-1.7907763,-2.6845940,-1.8544568,-1.2630579,
                -3.6118944,0.6507656,-3.7023663,-0.4840762,-3.0185792,
                -1.0195173,-2.6657267,-3.4429024,-0.8574250,-4.9931950,
                -1.6863816,-4.9764143,-1.9128474,-5.1121781,-3.6355388,
                -2.7287782,-5.2950834,-2.2084341,-5.0041797,-1.2508780,
                -5.1476823,-1.5761105,-2.5099535,-3.1597167,-1.2439155,
                -3.1713207,-0.0463122,-4.3192765,0.1221109,-2.9153120,
                -2.0652655,-2.1262048,-2.9798112,-1.4622523,-5.2863689,
                -0.8412450,-5.1455129,-2.8106830,-4.4151734,-3.4982401,
                -3.5305424,-5.5591245,-1.5178026,-5.7044968,-2.1067852,
                -4.5265881,-1.8249193,-3.4362490,-3.2629606,-0.6261111,
                -4.1083164,-0.4981271,-3.5502106,-0.1573053,-3.5893641,
                -1.6986800,-1.4263270,-3.8714653,-1.3613332,-4.4207767,
                -1.1596001,-5.6413088,-2.1845069,-3.9770692,-4.5320350,
                -3.2221731,-5.0081718,-2.1584683,-6.2691176,-1.5079445,
                -4.5932006,-2.9821774,-3.0000000,-3.0177097,-1.4063477,
                -4.4910390,0.2709247,-3.8387082,-0.9877625,-2.7722932,
                -1.4607377,-2.0137843,-3.8042018,-0.3450296,-4.8241426,
                -1.5601451,-4.6165425,-2.1031392,-4.5447814,-4.2687074,
                -2.3740778,-5.8019664,-2.4046666,-5.4521314,-1.8370995,
                -5.3142381,-2.6720984,-2.4932964,-4.0988893,-1.3912605,
                -3.8048807,-0.2007638,-4.3808303,-0.3326588,-2.3541693,
                -2.3791785,-1.4547309,-3.0514859,-0.7086999,-5.0047913,
                -0.5512708,-4.3667710,-2.8403764,-3.6849277,-3.7365933,
                -2.8770546,-5.9047673,-1.4534520,-5.7162709,-2.5809002,
                -4.4977265,-2.5711303,-3.2098828,-4.1324996,-0.5494868,
                -4.4346356,-0.6694643,-3.4531266,-0.3541810,-2.9079771,
                -1.9884953,-0.4989229,-3.6851094,-0.6081874,-3.8846548,
                -0.5640665,-4.6858522,-2.0861818,-2.8489564,-4.4805570,
                -2.4666793,-4.9861600,-1.7526416,-6.0903398,-1.8120414,
                -4.1450352,-3.5375900,-2.6912035,-3.5685695,-1.0995156,
                -4.7447932,0.2105194,-3.4102545,-1.1440842,-2.0361072,
                -1.4811009,-0.9184668,-3.5767273,0.5794160,-3.9379332,
                -0.9170525,-3.4798009,-1.6542437,-3.1810362,-4.0903835,
                -1.3004581,-5.3840711,-1.9098140,-4.9886145,-1.7762556,
                -4.6511874,-3.1183736,-1.8560748,-4.3713292,-1.0787196,
                -3.8198253,-0.0155133,-3.8630322,-0.4602589,-1.3326994,
                -2.2567196,-0.3858993,-2.5803902,0.4320689,-4.0354349,
                0.1908579,-2.8589839,-2.2389197,-2.2222645,-3.2015534,
                -1.5188872,-5.3378463,-0.7406286,-4.8180646,-2.3861996,
                -3.6680072,-2.6613856,-2.3434776,-4.3241348,-0.0383766,
                -4.1213203,-0.4901599,-2.8151748,-0.2327260,-1.7762480,
                -1.8738781,0.7591251,-2.9712217,0.4838373,-2.7400489,
                0.4376164,-3.0455806,-1.4219587,-1.0659983,-3.6712453,
                -1.0626425,-4.1099174,-0.7192270,-5.0158142,-1.4847507,
                -2.9259352,-3.4130915,-1.7721921,-3.4603780,-0.3534458,
                -4.3582470,0.4628516,-2.4628848,-0.9765448,-0.9100473,
                -1.1407412,0.4730591,-2.8680232,1.7535502,-2.4985492,
                0.0858958,-1.7593905,-0.7074528,-1.2188640,-3.2172672,
                0.3292435,-4.1467860,-0.8268455,-3.7024420,-1.1140777,
                -3.2362671,-2.9150594,-0.6604229,-3.9755779,-0.3495707,
                -3.2408523,0.4683395,-2.8427346,-0.3095991,0.0153606,
                -1.7870279,0.9094500,-1.7086723,1.7650108,-2.5761854,
                1.1945619,-0.8620275,-1.1885261,-0.2674273,-2.0622639,
                0.3308689,-4.0136103,0.4684036,-3.1573586,-1.6146532,
                -2.1630361,-2.1464065,-0.9435476,-3.8752531,0.8266296,
                -3.2345332,-0.0273128,-1.7437131,0.1277944,-0.3543004,
                -1.4662294,2.1499244,-1.9033882,1.6984293,-1.2176136,
                1.6205331,-0.9957841,-0.4083102,1.0869290,-2.3194805,
                0.7373893,-2.5859510,0.7402470,-3.2413335,-0.6619752,
                -1.1137586,-2.7041912,-0.3869338,-2.7744448,0.7144104,
                -3.4300142,0.9341424,-1.1380348,-0.5866786,0.4255162,
                -0.5773492,1.9409974,-1.8721027,2.9401210,-0.7684542,
                1.2016807,0.2404893,0.4848145,1.0214101,-1.9001265,
                2.2223967,-2.3451285,0.6054200,-1.8350411,-0.0331495,
                -1.2907831,-2.1959096,0.9082090,-3.0343337,0.6515370,
                -2.2003448,1.1279211,-1.4859103,-0.0000000};
cplx xFFT[1024];
int size = sizeof(s1)/sizeof(s1[0]);

int reverse_bit(int n, int length);
void fft();
void print_arr(cplx *arr);

int main(){

    fft(s1);
    print_arr(xFFT);

    return 0;
}

int reverse_bit(int n, int length){
    int reverse = 0;
    for(int i = 0; i < length; i++){
        reverse = (reverse << 1) | (n & 1);
        n = n >> 1;
    }
    return reverse;
}

void fft(float *arr){
    int num_bit = log2(size);
    for(int i = 0; i < size; i++){
        xFFT[reverse_bit(i, num_bit)] =  arr[i];
    }

    int q = round(log(size)/log(2));
    for(int s = 1; s < q+1; s++){
        int m = pow(2,s);
        int m2 = m/2;
        cplx w = 1;
        cplx wm = cexp(I*(M_PI/m2));
        for(int j = 1; j < m2+1; j++){
            for(int k = j; k < size+1; k+=m){
                cplx t = w * xFFT[k+m2-1];
                cplx u = xFFT[k-1];
                xFFT[k-1] = u + t;
                xFFT[k+m2-1] = u - t;
            }
            w = w * wm;
        }

    }
}

void print_arr(cplx *arr){
    for(int i = 0; i < size; i++){
        printf("%f + %fj\n", creal(arr[i]), cimag(arr[i]));
    }
}
